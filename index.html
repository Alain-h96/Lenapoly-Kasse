<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lenapoly â€“ Spielgeld Kasse</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
  padding:12px;
}
h1{text-align:center;margin:8px 0;}

/* LAYOUT */
.container{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* PANELS */
.panel{
  background:white;
  border-radius:12px;
  padding:12px;
}

/* WALLET */
.balance{
  font-size:24px;
  font-weight:bold;
  cursor:pointer;
}
#walletDetails{display:none}

/* WARENKORB */
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}
.cart-controls button{margin-left:4px}

/* PRODUKTE */
#grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
.product{
  background:white;
  border-radius:12px;
  padding:10px;
  text-align:center;
  cursor:pointer;
}
.product-img img{
  width:100%;
  max-width:90px;
  height:90px;
  object-fit:contain;
}
.product-price{font-weight:bold}

/* BUTTONS */
button{
  padding:8px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.pay{background:#4CAF50;color:white}
.clear{background:#ff4d4d;color:white}
.add{background:#2196F3;color:white}
.sub{background:#ff9800;color:white}
.full{width:100%;margin-top:6px}

input{
  width:100%;
  padding:6px;
  font-size:16px;
  margin-top:6px;
}

/* MODALS */
#numpad,#receiptOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal{
  background:white;
  padding:16px;
  border-radius:12px;
  width:260px;
}
.pad-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}
.pad-grid button{padding:14px;font-size:18px}

/* TABLET */
@media(min-width:900px){
  #grid{grid-template-columns:repeat(3,1fr)}
}
</style>
</head>

<body>

<h1>ðŸ§¾ Lenapoly-Kasse</h1>

<div class="container">

  <!-- WALLET -->
  <div class="panel">
    <h3>ðŸ’° Wallet</h3>
    <div id="player"></div>
    <div class="balance" id="balance" onclick="toggleWallet()"></div>

    <div id="walletDetails">
      <input type="number" id="amount" placeholder="Betrag eingeben">
      <button class="add full" onclick="walletAdd()">âž• HinzufÃ¼gen</button>
      <button class="sub full" onclick="walletSub()">âž– Abziehen</button>
    </div>
  </div>

  <!-- WARENKORB -->
  <div class="panel">
    <h3>ðŸ›’ Warenkorb</h3>
    <div id="cartItems"></div>
    <div id="total">Gesamt: 0 ðŸ’°</div>
    <button class="pay full" onclick="pay()">Bezahlen</button>
    <button class="clear full" onclick="clearCart()">Leeren</button>
  </div>

  <!-- PRODUKTE -->
  <div id="grid"></div>

</div>

<!-- NUMPAD -->
<div id="numpad" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>Menge</h3>
    <input id="qtyInput" readonly value="1"
           style="width:100%;font-size:22px;text-align:center">
    <div class="pad-grid">
      <button onclick="addNum(1)">1</button><button onclick="addNum(2)">2</button><button onclick="addNum(3)">3</button>
      <button onclick="addNum(4)">4</button><button onclick="addNum(5)">5</button><button onclick="addNum(6)">6</button>
      <button onclick="addNum(7)">7</button><button onclick="addNum(8)">8</button><button onclick="addNum(9)">9</button>
      <button onclick="clearNum()">C</button><button onclick="addNum(0)">0</button>
      <button class="pay" onclick="confirmQty()">OK</button>
    </div>
  </div>
</div>

<!-- QUITTUNG -->
<div id="receiptOverlay" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>ðŸ§¾ Quittung</h3>
    <div id="receiptContent"></div>
    <button class="pay full" onclick="receiptOverlay.style.display='none'">OK</button>
  </div>
</div>

<script>
// ---------- DOM ----------
const grid=document.getElementById("grid");
const cartItems=document.getElementById("cartItems");
const total=document.getElementById("total");
const balanceEl=document.getElementById("balance");
const amount=document.getElementById("amount");
const playerEl=document.getElementById("player");
const receiptOverlay=document.getElementById("receiptOverlay");
const receiptContent=document.getElementById("receiptContent");
const numpad=document.getElementById("numpad");
const qtyInput=document.getElementById("qtyInput");
const walletDetails=document.getElementById("walletDetails");

// ---------- WALLET ----------
const params=new URLSearchParams(location.search);
const player=params.get("player")||"gast";
const walletKey="wallet_"+player;
playerEl.innerText="Spieler: "+player;

let balance=parseInt(localStorage.getItem(walletKey)||100);
updateWallet();

function updateWallet(){
  balanceEl.innerText=balance+" ðŸ’° (antippen)";
  localStorage.setItem(walletKey,balance);
}
function toggleWallet(){
  walletDetails.style.display=
    walletDetails.style.display==="none"?"block":"none";
}
function walletAdd(){
  const v=parseInt(amount.value); if(!v) return;
  balance+=v; updateWallet(); amount.value="";
}
function walletSub(){
  const v=parseInt(amount.value); if(!v) return;
  balance-=v; if(balance<0) alert("âš ï¸ Wallet im Minus!");
  updateWallet(); amount.value="";
}

// ---------- PRODUKTE (DEINE LISTE) ----------
const products=[
["Haribo Einzelteile",10,"haribo_einzelteile.png"],
["Kaubonbons",10,"kaubonbons.png"],
["Apfelringe",15,"apfelringe.png"],
["GlÃ¼hwÃ¼rmchen (sauer)",15,"gluehwuermchen_sauer.png"],
["Nimm Zwei",20,"nimm_zwei.png"],
["Maoam",25,"maoam.png"],
["Haribo Vegan TÃ¼tchen",40,"haribo_tuete_vegan.png"],
["Haribo TÃ¼tchen",40,"haribo_tuete.png"],
["Bounty",40,"bounty.png"],
["Yogurette",60,"yogurette.png"],
["Milky Way",60,"milkyway.png"],
["Amicelli",80,"amicelli.png"],
["KitKat",80,"kitkat.png"],
["KitKat White",90,"kitkat_white.png"],
["Snickers",100,"snickers.png"],
["Mars",100,"mars.png"],
["Twix White",110,"twix_white.png"],
["Kinder Country",120,"kinder_country.png"],
["Knoppers",120,"knoppers.png"],
["Seifenblasen",300,"seifenblasen.png"],
["Flummi bunt (klein)",700,"flummi_bunt_klein.png"],
["Flummi glitzer (klein)",750,"flummi_glitzer_klein.png"],
["Flummi bunt (groÃŸ)",800,"flummi_bunt_gross.png"],
["Flummi glitzer (groÃŸ)",850,"flummi_glitzer_gross.png"],
["Squishy Balls",1000,"squishy_balls.png"],
["Mini Lego",1200,"mini_lego.png"],
["Return Ball",1500,"return_ball.png"],
["Pac-Man Konsole",3000,"pacman.png"]
];

let cart={}, currentProduct=null;

products.forEach(p=>{
  const d=document.createElement("div");
  d.className="product";
  d.innerHTML=`
    <div class="product-img">
      <img src="images/${p[2]}" alt="${p[0]}">
    </div>
    <div>${p[0]}</div>
    <div class="product-price">${p[1]} ðŸ’°</div>`;
  d.onclick=()=>openPad(p);
  grid.appendChild(d);
});

// ---------- NUMPAD ----------
function openPad(p){
  currentProduct=p;
  qtyInput.value="1";
  numpad.style.display="flex";
}
function addNum(n){
  qtyInput.value=qtyInput.value==="0"?n:qtyInput.value+n;
}
function clearNum(){qtyInput.value="0";}
function confirmQty(){
  const q=parseInt(qtyInput.value);
  if(q>0){
    const [name,price]=currentProduct;
    if(!cart[name]) cart[name]={price,qty:0};
    cart[name].qty+=q;
    updateCart();
  }
  numpad.style.display="none";
}

// ---------- WARENKORB ----------
function updateCart(){
  cartItems.innerHTML="";
  let sum=0;
  for(const k in cart){
    const i=cart[k];
    sum+=i.price*i.qty;
    cartItems.innerHTML+=`
      <div class="cart-item">
        ${k} (${i.qty})
        <span class="cart-controls">
          <button onclick="changeQty('${k}',-1)">âˆ’</button>
          <button onclick="changeQty('${k}',1)">+</button>
        </span>
      </div>`;
  }
  total.innerText="Gesamt: "+sum+" ðŸ’°";
}
function changeQty(k,d){
  cart[k].qty+=d;
  if(cart[k].qty<=0) delete cart[k];
  updateCart();
}
function clearCart(){cart={};updateCart();}

// ---------- BEZAHLEN ----------
function pay(){
  let sum=0, html="";
  for(const k in cart){
    const i=cart[k];
    sum+=i.price*i.qty;
    html+=`${k}: ${i.qty} Ã— ${i.price} = ${i.qty*i.price} ðŸ’°<br>`;
  }
  if(sum===0) return;
  if(balance-sum<0){alert("âš ï¸ Nicht genug Guthaben!");return;}
  balance-=sum; updateWallet();
  receiptContent.innerHTML=html+`<hr><b>Gesamt: ${sum} ðŸ’°</b>`;
  receiptOverlay.style.display="flex";
  clearCart();
}
</script>

</body>
</html>
