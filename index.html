<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nostalgie Shop</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
  padding:12px;
}
h1{text-align:center;margin:8px 0;}

/* LAYOUT */
.container{
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* WALLET + CART */
.panel{
  background:white;
  border-radius:12px;
  padding:12px;
}

/* WALLET */
.balance{
  font-size:24px;
  font-weight:bold;
  cursor:pointer;
}
#walletDetails{display:none}

/* WARENKORB */
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:6px;
}
.cart-controls button{margin-left:4px}

/* PRODUKTE */
#grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
}
.product{
  background:white;
  border-radius:12px;
  padding:10px;
  text-align:center;
  cursor:pointer;
}
.product-img{font-size:36px}
.product-price{font-weight:bold}

/* BUTTONS */
button{
  padding:8px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.pay{background:#4CAF50;color:white}
.clear{background:#ff4d4d;color:white}
.add{background:#2196F3;color:white}
.sub{background:#ff9800;color:white}
.full{width:100%;margin-top:6px}

input{
  width:100%;
  padding:6px;
  font-size:16px;
  margin-top:6px;
}

/* MODALS */
#numpad,#receiptOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal{
  background:white;
  padding:16px;
  border-radius:12px;
  width:260px;
}
.pad-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}
.pad-grid button{padding:14px;font-size:18px}

/* TABLET */
@media(min-width:900px){
  #grid{grid-template-columns:repeat(3,1fr)}
}
</style>
</head>

<body>

<h1>ðŸ§¾ Nostalgie Shop</h1>

<div class="container">

  <!-- WALLET -->
  <div class="panel">
    <h3>ðŸ’° Wallet</h3>
    <div id="player"></div>
    <div class="balance" id="balance" onclick="toggleWallet()"></div>

    <div id="walletDetails">
      <input type="number" id="amount" placeholder="Betrag eingeben">
      <button class="add full" onclick="walletAdd()">âž• HinzufÃ¼gen</button>
      <button class="sub full" onclick="walletSub()">âž– Abziehen</button>
    </div>
  </div>

  <!-- WARENKORB -->
  <div class="panel">
    <h3>ðŸ›’ Warenkorb</h3>
    <div id="cartItems"></div>
    <div id="total">Gesamt: 0 ðŸ’°</div>
    <button class="pay full" onclick="pay()">Bezahlen</button>
    <button class="clear full" onclick="clearCart()">Leeren</button>
  </div>

  <!-- PRODUKTE -->
  <div id="grid"></div>

</div>

<!-- NUMPAD -->
<div id="numpad" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>Menge</h3>
    <input id="qtyInput" readonly value="1" style="width:100%;font-size:22px;text-align:center">
    <div class="pad-grid">
      <button onclick="addNum(1)">1</button><button onclick="addNum(2)">2</button><button onclick="addNum(3)">3</button>
      <button onclick="addNum(4)">4</button><button onclick="addNum(5)">5</button><button onclick="addNum(6)">6</button>
      <button onclick="addNum(7)">7</button><button onclick="addNum(8)">8</button><button onclick="addNum(9)">9</button>
      <button onclick="clearNum()">C</button><button onclick="addNum(0)">0</button>
      <button class="pay" onclick="confirmQty()">OK</button>
    </div>
  </div>
</div>

<!-- QUITTUNG -->
<div id="receiptOverlay" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>ðŸ§¾ Quittung</h3>
    <div id="receiptContent"></div>
    <button class="pay full" onclick="receiptOverlay.style.display='none'">OK</button>
  </div>
</div>

<script>
// DOM
const grid=document.getElementById("grid");
const cartItems=document.getElementById("cartItems");
const total=document.getElementById("total");
const balanceEl=document.getElementById("balance");
const amount=document.getElementById("amount");
const playerEl=document.getElementById("player");
const receiptOverlay=document.getElementById("receiptOverlay");
const receiptContent=document.getElementById("receiptContent");
const numpad=document.getElementById("numpad");
const qtyInput=document.getElementById("qtyInput");
const walletDetails=document.getElementById("walletDetails");

// WALLET
const params=new URLSearchParams(location.search);
const player=params.get("player")||"gast";
const walletKey="wallet_"+player;
playerEl.innerText="Spieler: "+player;

let balance=parseInt(localStorage.getItem(walletKey)||100);
updateWallet();

function updateWallet(){
  balanceEl.innerText=balance+" ðŸ’° (auf wallet zugreifen)";
  localStorage.setItem(walletKey,balance);
}
function toggleWallet(){
  walletDetails.style.display=walletDetails.style.display==="none"?"block":"none";
}
function walletAdd(){
  const v=parseInt(amount.value); if(!v) return;
  balance+=v; updateWallet(); amount.value="";
}
function walletSub(){
  const v=parseInt(amount.value); if(!v) return;
  balance-=v; if(balance<0) alert("âš ï¸ Wallet im Minus!");
  updateWallet(); amount.value="";
}

// PRODUKTE
const products=[
["ðŸ­ Lolli",60],["ðŸ¬ Bonbons",80],["ðŸ« Mini-Schoko",110],
["ðŸª Keks",250],["ðŸ« Schokoriegel",300],["ðŸ§‡ Waffel",320],
["ðŸ¬ GummibÃ¤rchen",280],["ðŸ¿ Popcorn",450],["ðŸ¥¨ Salzstangen",220],
["ðŸ© Donut",300],["ðŸ§ Muffin",320],["ðŸ° KuchenstÃ¼ck",350],
["ðŸ¦ Eis",280],["ðŸ« Brownie",300],["ðŸ¥ Croissant",260],
["ðŸª Doppelkeks",300],["ðŸ« Nussriegel",330],["ðŸ­ Zuckerstange",120],
["ðŸ¬ Karamell",150],["ðŸª Cookie",250],["ðŸ¿ Popcorn XL",650],
["ðŸ« Mega-Riegel",550],["ðŸ­ SÃ¼ÃŸ-Mix",900],["ðŸŽ Ãœberraschung",900],
["ðŸŽ‰ Party-Box",1100],["ðŸ« Gold-Schoko",1300],["ðŸ¬ XXL-Mix",1000],
["ðŸª Familien-Pack",700],["ðŸ¿ Kino-Set",650],["ðŸ† Jackpot-Box",1300]
];

let cart={}, currentProduct=null;

products.forEach(p=>{
  const d=document.createElement("div");
  d.className="product";
  d.innerHTML=`
    <div class="product-img">${p[0].split(" ")[0]}</div>
    <div>${p[0]}</div>
    <div class="product-price">${p[1]} ðŸ’°</div>`;
  d.onclick=()=>openPad(p);
  grid.appendChild(d);
});

// NUMPAD
function openPad(p){currentProduct=p;qtyInput.value="1";numpad.style.display="flex";}
function addNum(n){qtyInput.value=qtyInput.value==="0"?n:qtyInput.value+n;}
function clearNum(){qtyInput.value="0";}
function confirmQty(){
  const q=parseInt(qtyInput.value);
  if(q>0){
    const [name,price]=currentProduct;
    if(!cart[name]) cart[name]={price,qty:0};
    cart[name].qty+=q;
    updateCart();
  }
  numpad.style.display="none";
}

// WARENKORB
function updateCart(){
  cartItems.innerHTML="";
  let sum=0;
  for(const k in cart){
    const i=cart[k];
    sum+=i.price*i.qty;
    cartItems.innerHTML+=`
      <div class="cart-item">
        ${k} (${i.qty})
        <span class="cart-controls">
          <button onclick="changeQty('${k}',-1)">âˆ’</button>
          <button onclick="changeQty('${k}',1)">+</button>
        </span>
      </div>`;
  }
  total.innerText="Gesamt: "+sum+" ðŸ’°";
}
function changeQty(k,d){
  cart[k].qty+=d;
  if(cart[k].qty<=0) delete cart[k];
  updateCart();
}
function clearCart(){cart={};updateCart();}

// BEZAHLEN
function pay(){
  let sum=0, html="";
  for(const k in cart){
    const i=cart[k];
    sum+=i.price*i.qty;
    html+=`${k}: ${i.qty} Ã— ${i.price} = ${i.qty*i.price} ðŸ’°<br>`;
  }
  if(sum===0) return;
  if(balance-sum<0){alert("âš ï¸ Nicht genug Guthaben!");return;}
  balance-=sum; updateWallet();
  receiptContent.innerHTML=html+`<hr><b>Gesamt: ${sum} ðŸ’°</b>`;
  receiptOverlay.style.display="flex";
  clearCart();
}
</script>

</body>
</html>
